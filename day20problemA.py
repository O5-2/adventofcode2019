maze = """                                         W     P     B       T           P   K                                             
                                         L     W     W       Z           S   S                                             
  #######################################.#####.#####.#######.###########.###.###########################################  
  #.........#.............#...#.#...#.#.......#.#.#.........#.#...#...#.....#...#.............#...#...#.....#...#...#.#.#  
  #####.#######.#.#######.#.###.###.#.###.#.#.#.#.###.#######.#.#####.#####.#.###.#####.#.###.###.#.###.###.###.#.###.#.#  
  #...........#.#.#.....#.#.#.#.#.#.....#.#.#.#.....#.....#.....#...#.......#.........#.#.#...#.....#.....#.#...#.....#.#  
  #.###.#.#.#####.###.#.#.#.#.#.#.#.#.#.###.#####.###.#####.###.#.###.#.#####.#########.#.#######.###.###.#####.#.#.###.#  
  #.#...#.#.#.#...#...#...........#.#.#.......#...#.....#.#.#.....#...#.#...#.....#...#.#.#.....#...#.#.#.#...#...#.#...#  
  ###.###.###.#########.###.#.###.###.#####.#####.#.#.###.###.###.###.###.#.#.###.#.#######.#####.###.#.###.#####.#####.#  
  #.#.#.#.....#.#...#.#.#...#.#...........#.#.....#.#.#.#.#...#.#.#.......#.#.#...#.#.#...#...#.....#.#.#.......#...#...#  
  #.###.###.###.###.#.#####.###.#.###.###.#####.#####.#.#.###.#.###.#######.#.#####.#.###.#.#####.###.#.#.###.###.#####.#  
  #.#.#.......#...............#.#.#.....#.#.....#...#.......#...#.#.#.....#.#...#...#.#.....#...#.#...#...#...#...#.....#  
  #.#.#.###.###.#######.#.#.#########.#####.#.###.#####.#.###.###.#####.#.#.#.#####.#.#.#####.###.#.###.#########.###.###  
  #.......#...#.#.....#.#.#...#.#...#...#...#.....#.#...#.#.........#...#...#.#.................#.......#.#.#.......#...#  
  #.###.#.#########.#####.#####.###.#.#####.#.#.###.#.#.#######.#######.#.###.#####.###.#.#######.#######.#.#####.###.###  
  #...#.#...#.#.....#.......#.....#.#...#.#.#.#.....#.#.#.#.....#.#.....#.#...#.#.....#.#.#.#.....#.......#.#.....#...#.#  
  #.###.#####.#####.#.###.#######.#.###.#.###.#.###.#.###.###.#.#.###.###.###.#.###.#######.###.#####.#####.#.#######.#.#  
  #.#.#.#.....#.#...#.#.#.#.#.....#.#.....#...#.#...#.......#.#.#.#.#...#.#.#.#.....#...#.#.......#.#.#.#.#.#...#.....#.#  
  #.#.#####.###.###.###.###.###.#.#.#.###.#########.###.#######.#.#.###.###.#.#.#.#.#.###.###.###.#.#.#.#.#.#.###.#####.#  
  #.#...#.....#.........#.....#.#.#.....#.#...#.....#.......#.....#.......#.....#.#.#.#...#.....#.#.......#.#...#.#.....#  
  #.#.#####.#.#.###.###.#####.###.#.#.#####.#######.#.#######.#######.#.###.###.#####.#.###.#.#.#.###.#.###.#.###.#.###.#  
  #.#.......#.#.#.#.#.#...#.#.......#.#.#.....#.#...#.#.....#.....#...#.#...#...#...........#.#.#.#.#.#.#...#...#.....#.#  
  #.#.#.#########.###.#.###.#########.###.#.###.#.###.#.###.###.###.#.#####.###.#.#.#####.#.###.###.#.#####.#.#####.#####  
  #.#.#.#.......#.....#.#.....#...#.....#.#...#.#.#.#...#.#.#.....#.#.....#.#...#.#.#.#.#.#...#.....#...#...#.#...#.#.#.#  
  #.###.#.###########.#.#.###.###.#####.#.#.###.#.#.#.###.#.#.#####.###.#######.#.#.#.#.###########.#.#####.#.#.###.#.#.#  
  #...#.....#...#.#.#.....#.#.#.......#...#...#.....#...#...#.#...#.#.....#.#...#.#.#.....#.#.....#.#.......#...#...#...#  
  #.###.#.#####.#.#.###.#.#.#####.#.#######.###.###.#.###.###.#.#.###.#####.###.#.#.#.###.#.#####.#.#.#.###.#.#.###.#.###  
  #.#.#.#...#...#.......#.#.#.....#.........#.#.#...#.#...#.#...#...#.#...#...#.#.#...#.#.....#...#.#.#...#.#.#.........#  
  #.#.#.#######.#####.#.###.#######.#.#####.#.#.###.#.###.#.#######.#.#.#.#.###.#.#.#.#.#########.#####.#.#.#####.###.#.#  
  #.......#...#.#.#.#.#.....#.#...#.#.....#.#...#.#.#.#.....#.....#.#.#.#...#.....#.#.......#.#.......#.#.#.#...#.#...#.#  
  ###.#.###.###.#.#.#.#####.#.#.#.#.#####.#######.#.###.#.#.#.#.###.#.###.#####.###.###.###.#.#.#.#.#.#.#####.###.#####.#  
  #...#.#.........#.#.#...#.#...#...#.......#.........#.#.#.#.#.....#.........#.#...#...#...#...#.#.#.#...#.#...#...#.#.#  
  ###.#######.#.###.#.###.###########.###########.#########.#.#########.#########.###########.#####.#.###.#.#.###.###.###  
  #.......#.#.#...#.#...#.#.....#    N           E         R T         O         F        #.#...#...#.#.......#.#...#.#.#  
  #######.#.#####.#.#.###.#####.#    O           I         I T         O         Y        #.#.#########.###.###.#.###.#.#  
  #.#.......................#.#.#                                                         #.#.#.#.#...#.#.............#.#  
  #.#.#######.#####.#.#.#.###.#.#                                                         #.#.#.#.#.#.#####.#########.#.#  
IP..#.....#.....#...#.#.#...#.#.#                                                         #.#...#.#.#...#.#.........#...#  
  #.#####.#.#.#.###.#######.#.#.#                                                         #.#.###.###.###.#####.#.#####.#  
  #.....#.#.#.#.#...#.........#..YL                                                     IH........#.#...#.#...#.#...#.#..CI
  #.#####.#########.#########.#.#                                                         #.#####.#.#.#.#.#.#.###.###.#.#  
  #.......#...#.#.#.#.#.#.#.....#                                                         #.#.........#.....#.....#.#.#.#  
  #####.###.###.#.###.#.#.#######                                                         #####################.###.#.###  
  #.#.#.#.....#.....#.........#.#                                                         #.......#...........#.#.....#.#  
  #.#.###.#.#####.#######.###.#.#                                                         #.#####.#.#####.###.###.###.#.#  
UI....#.#.#.#.#.....#.#.#...#...#                                                         #.#.#.#.....#.....#.#.....#....TB
  #.###.###.#.###.###.#.###.###.#                                                         #.#.#.###.#########.###.#.#####  
  #.#...#.........#...#...#.#....UA                                                     UI........#...#...#.....#.#.....#  
  #.###.#####.###.#.###.#.#.#.###                                                         #.#######.###.#######.#######.#  
AU............#.........#...#....FQ                                                       #.#...#.#...#.#...............#  
  ###.#.#.#.#.#####.#############                                                         #####.#.#####.###.#.#.#.#####.#  
OO..#.#.#.#.#.#.#...#.......#...#                                                         #.#.....#.......#.#.#.#.#...#.#  
  #.#####.#####.###.#.#.#.###.#.#                                                         #.#.#.###.#.#.#######.###.###.#  
  #...#...#.#.#...#.#.#.#.....#.#                                                       TZ..#.#.#...#.#...#.#.#.#...#.#.#  
  #.###.#.#.#.#.#######.#######.#                                                         #.#.#.#.###.#####.#.#####.#.###  
  #...#.#.#.........#.....#.#....IP                                                       #...#.#...#...#.#.......#...#..UA
  ###.#####.#####.#####.###.###.#                                                         #####.###.#.###.###.#.###.#.#.#  
  #.#.......#.#.#.......#.....#.#                                                         #.#.#.....#.........#.....#...#  
  #.#########.#.#############.###                                                         #.#.#########################.#  
  #...........#.........#.......#                                                       RL..#.......#...............#.#.#  
  #.###.#.###.#.#.#####.#.#####.#                                                         #.#.#####.###.#.###.#.###.#.###  
FY..#...#.#.....#.#...#.....#....AU                                                       #.#...#.......#.#.#.#.#.#.....#  
  #.#########.#######.###########                                                         #.#.#######.#.###.#####.#.#.###  
  #...#.....#.#.#.......#.......#                                                         #.#.......#.#...#.#.....#.#.#..PH
  #####.#######.#.#.#.###.#####.#                                                         #.#.#.###########.###.#.#.###.#  
  #.#...#.#...#.#.#.#...#...#....PS                                                       #...#.#.....#.#...#.#.#.#.....#  
  #.###.#.#.###.###.#.#.#.#.#####                                                         #######.#####.###.#.###.#######  
  #...#...#...#...#.#.#.#.#.....#                                                         #.....................#.......#  
  #.###.###.#.#.#.#.###.###.#####                                                         #.#####.###.#####.###.#.###.###  
FQ..........#...#.....#.....#.#.#                                                       WL....#.....#.#.#...#...#.#...#..RL
  #####################.###.#.#.#                                                         #.#####.###.#.#######.#.#.###.#  
EI....#.#.#...#.......#.#.#.#.#.#                                                         #.#.#.....#.#...#.#.....#...#.#  
  ###.#.#.#.#.#.###.#####.###.#.#                                                         ###.#.#.#####.###.###.#####.#.#  
  #.........#.....#..............TP                                                       #.#.#.#.#.#.......#.#...#.....#  
  #.#.#########.#.#.#.#.###.###.#                                                         #.#.#####.###.#####.###########  
  #.#.#.....#...#.#.#.#.#...#.#.#                                                       CI....#.........#.#.....#...#.#.#  
  #####.###.###############.#.###                                                         ###.#.###.###.#.#.#.#####.#.#.#  
RI....#.#.#.#.#.#.....#.#.#.#...#                                                         #...#.#...#.......#...#.#.#.#.#  
  #.###.#.#.#.#.#####.#.#.#####.#                                                         #.###.###.#####.#.###.#.#.#.#.#  
  #...#...#...#.#.#.#.#...#.#...#                                                         #.....#.#...#...#.#...........#  
  #.#####.###.#.#.#.#.#.###.#.#.#                                                         #.#.###.#.#######.#.#.#.#.#####  
AA..........#.................#..KS                                                       #.#...#.....#.....#.#.#.#......ZS
  #.###.###.#.###.#.###.###.###.#                                                         #.#.###.#####.###.#.###.###.###  
  #.#.....#.#.#.#.#...#.#.....#.#                                                         #.#...#.....#.#...#.#...#.....#  
  #.###.#####.#.#####.#########.#    T             Z     P         Z       E     B P      ###.#########.#.###.#.#####.#.#  
  #...#.....#.....#...#.........#    B             E     H         S       M     W W      #.#...#...#...#.#...#.#.#...#.#  
  #.#####.#.#.#.#####.###.###.#.#####.#############.#####.#########.#######.#####.#.#######.#.###.###########.###.###.###  
  #.....#.#.#.#...#...#.#.#...#...#.#.....#.....#.....#.....#.....#.#.....#.#.....#.......#.........#...............#...#  
  #.###.#.#.#.#.###.#.#.###########.###.###.#.#.###.#######.#.###.#.#.###.#.#.###.###.#########.#.#########.###.#.#.#.###  
  #.#.#.#.#.#.#...#.#...#.#.#...#.#.#...#.#.#.#.#.....#.....#.#.....#...#.#.#.#...#.....#...#.#.#.....#.#.....#.#.#.#...#  
  #.#.#.###.#######.#####.#.###.#.#.#.###.###.#.#.#######.###.#########.#.#.#.#####.#.###.###.#.###.###.#.###.#####.#.#.#  
  #...#.#...#...#.#...#.............#...#.....#.#...#.....#...#.....#...#...#.#.#.#.#.....#.#.#...#.....#...#.#.#...#.#.#  
  #.#.###.#.#.###.#######.###.#####.#.#######.#.#.###.#.#####.#.###.#.#######.#.#.###.#####.#.#######.###.#####.#######.#  
  #.#.#.#.#...........#...#...#.#.........#...#.....#.#.#.#.....#.#.#.......#...#.....#.....#.#.#...#.#.........#.#.....#  
  #.#.#.#####.#.#########.###.#.#####.#####.#.###.###.###.###.#.###.#######.###.###.#####.###.#.#.#########.#.###.#######  
  #.#.....#...#.#.#.........#.#.....#.....#.#...#.#.........#.#.#.#.#...#...#.....#...............#.#.....#.#.........#.#  
  #.#.#######.###.###.#############.#.#######.###.#######.#.#.###.#.#.#.#.###.#.#######.#.#####.###.#.#######.#.#.#.###.#  
  #.#.....#.......#.#.#.#.#.#.........#.........#.#.......#.#...#.#.#.#.....#.#.#.#.....#...#...#.#.#.....#.#.#.#.#...#.#  
  #.###.#######.###.###.#.#.#.#.###.#.#######.#######.#.#.###.#.#.#.#.#.#####.###.#.#.###.#####.#.#.#.#####.###.#######.#  
  #.#...#.#.....#.#.#.........#.#.#.#...#.......#.....#.#...#.#.#...#.#.#.........#.#.#.#.....#.......#.#.....#.#...#.#.#  
  #.#####.###.#.#.#.###.#.###.###.###.#######.#####.#.###.#######.###.#.#.###.#.#####.#.#######.#.###.#.#####.###.###.#.#  
  #.#.#.......#.#.......#.#...#.......#.........#...#...#.#...#.....#.#.#.#.#.#.#...........#...#.#...........#.#.......#  
  #.#.###.#########.###.#######.###.#.#####.#.#######.#####.#.#.#.###.#####.#.#########.#####.#.#.#######.#.###.#.#####.#  
  #.....#...#.......#.....#.....#.#.#.#.#.#.#.#.#...........#.#.#...#...#.....#...#.#.#.#...#.#.#.....#...#.......#...#.#  
  ###.#######.#.#####.#######.###.###.#.#.###.#.#######.#########.###.#####.#.#.###.#.#.#.#####.###.#.###############.###  
  #.....#.....#.#.....#.#.....#.#...#.#.#...#...#.#.....#...#...#...#...#.#.#.#.#.#.#.......#.#...#.#.#.#.............#.#  
  #.#########.#.#######.#######.###.#.###.#.#.###.###.###.#.###.#.#####.#.###.#.#.#.###.#.###.#####.#.#.#.#####.#####.#.#  
  #...#.......#.#.#.#...........#.........#.#.#.#.#.......#.#...#...#.......#.........#.#.........#.#.#.#...#.#...#.....#  
  #.#.#####.#.#.#.#.###########.###.#.#####.#.#.#.#######.###.#.###.###.#########.#####.#####.#########.#.###.#.#######.#  
  #.#.#.....#.#.#...................#.#.#...#.#.#...#.......#.#.......#.....#.....#...#.#.#.....#...........#.#.#.#.#.#.#  
  ###.###.#.#######.#.###.#########.###.#.#.#.###.#.#.#########.###.#####.###.#######.#.#.#####.#.#.#.#######.#.#.#.#.###  
  #.....#.#...#.....#.#.........#.#.#.#...#.#.#...#.#.#.....#.....#.#.......#.......#.....#...#...#.#.........#.........#  
  ###.###.###.#####.#############.###.#.#.###.#.###.#.#.#.#####.#####.#######.#######.#######.###.###########.###.###.###  
  #.#.#.#...#...#...#.#.#...#...#.......#.#.....#.#.#...#.#.......#...#.....#.#...#...........#.#.........#.#.#...#.....#  
  #.#.#.#.#.#.#######.#.###.#.###.#.###.###.#####.#.#####.#####.#####.###.#.#.#.#######.#####.#.#.#.#######.#.###.#.#.#.#  
  #...#...#.#...#.................#.#.....#.#...........#...#.......#.....#.#.......#.......#...#.#.......#.....#.#.#.#.#  
  ###################################.#######.###########.#######.#.#######.###.#######.#################################  
                                     N       Y           T       Z E       Z   T       I                                   
                                     O       L           P       Z M       E   T       H                                   """
mazeA = """         A           
         A           
  #######.#########  
  #######.........#  
  #######.#######.#  
  #######.#######.#  
  #######.#######.#  
  #####  B    ###.#  
BC...##  C    ###.#  
  ##.##       ###.#  
  ##...DE  F  ###.#  
  #####    G  ###.#  
  #########.#####.#  
DE..#######...###.#  
  #.#########.###.#  
FG..#########.....#  
  ###########.#####  
             Z       
             Z       """
# This is a test case.

mazeB = """                   A               
                   A               
  #################.#############  
  #.#...#...................#.#.#  
  #.#.#.###.###.###.#########.#.#  
  #.#.#.......#...#.....#.#.#...#  
  #.#########.###.#####.#.#.###.#  
  #.............#.#.....#.......#  
  ###.###########.###.#####.#.#.#  
  #.....#        A   C    #.#.#.#  
  #######        S   P    #####.#  
  #.#...#                 #......VT
  #.#.#.#                 #.#####  
  #...#.#               YN....#.#  
  #.###.#                 #####.#  
DI....#.#                 #.....#  
  #####.#                 #.###.#  
ZZ......#               QG....#..AS
  ###.###                 #######  
JO..#.#.#                 #.....#  
  #.#.#.#                 ###.#.#  
  #...#..DI             BU....#..LF
  #####.#                 #.#####  
YN......#               VT..#....QG
  #.###.#                 #.###.#  
  #.#...#                 #.....#  
  ###.###    J L     J    #.#.###  
  #.....#    O F     P    #.#...#  
  #.###.#####.#.#####.#####.###.#  
  #...#.#.#...#.....#.....#.#...#  
  #.#####.###.###.#.#.#########.#  
  #...#.#.....#...#.#.#.#.....#.#  
  #.###.#####.###.###.#.#.#######  
  #.#.........#...#.............#  
  #########.###.###.#############  
           B   J   C               
           U   P   P               """
# This is also a test case.

maze = maze.split("\n")

def mazeLocation(location, offsetX, offsetY):
    return maze[location[1]+offsetY][location[0]+offsetX]

def portalName(location):
    name = ""
    if (mazeLocation(location, 0, -1) not in " .#") and (mazeLocation(location, 0, -2) not in " .#"):
        return mazeLocation(location, 0, -2)+mazeLocation(location, 0, -1)
    elif (mazeLocation(location, 0, 1) not in " .#") and (mazeLocation(location, 0, 2) not in " .#"):
        return mazeLocation(location, 0, 1)+mazeLocation(location, 0, 2)
    elif (mazeLocation(location, -1, 0) not in " .#") and (mazeLocation(location, -2, 0) not in " .#"):
        return mazeLocation(location, -2, 0)+mazeLocation(location, -1, 0)
    elif (mazeLocation(location, 1, 0) not in " .#") and (mazeLocation(location, 2, 0) not in " .#"):
        return mazeLocation(location, 1, 0)+mazeLocation(location, 2, 0)
    return "//"

def findOtherEnd(oneEnd): # This function assumes that oneEnd is the spot on the path where you enter the portal.
    realX = 0
    realY = 0
    done = False
    for y in range(2, len(maze)-2):
        if done:
            break
        for x in range(2, len(maze[0])-2):
            if ((portalName([x, y]) == portalName(oneEnd)) and ((x != oneEnd[0]) or (y != oneEnd[1]))) and (maze[y][x] == '.'):
                realX = x
                realY = y
                done = True
                break
    return [realX, realY]

startX = 0
startY = 0
done = False
for y in range(2, len(maze)-2):
    if done:
        break
    for x in range(2, len(maze[0])-2):
        if portalName([x, y]) == "AA":
            startX = x
            startY = y
            done = True
            break
# starts it out near the AA entrance.

bfs = [[[startX, startY], 0]]
alreadyReached = []
# defines bfs container. Should have: location, distance.
# It should also have a list of already-reached locations.

minDistance = 1000000
while bfs:
    print(len(bfs))
    print(len(alreadyReached))
    print("--")
    #print(bfs[0][0])
    if portalName(bfs[0][0]) == "ZZ":
        minDistance = bfs[0][1]
        break
    # is bfs[0][0] next to ZZ? if so, minDistance = bfs[0][1] and break.
    if bfs[0][0] in alreadyReached:
        bfs = bfs[1:]
        continue
    for i in [[0, -1], [0, 1], [-1, 0], [1, 0]]:
        if [bfs[0][0][0]+i[0], bfs[0][0][1]+i[1]] in alreadyReached:
            continue
        elif mazeLocation(bfs[0][0], i[0], i[1]) not in " .#":
            bfs.append([findOtherEnd(bfs[0][0]), bfs[0][1]+1])
        elif mazeLocation(bfs[0][0], i[0], i[1]) == '.':
            bfs.append([[bfs[0][0][0]+i[0], bfs[0][0][1]+i[1]], bfs[0][1]+1])
        # dealing with [bfs[0][0][0]+i[0], bfs[0][0][1]+i[1]]
    # add the neighbors of bfs[0][0] to bfs, unless the neighbors have already been visited. make sure to allow portals.
    alreadyReached = alreadyReached + [bfs[0][0]]
    bfs = bfs[1:]

print(minDistance)

# The maze is something like 120 by 120.
# Worst case, we should only have to deal with 1/2 (ratio of paths to total size) of 8/9 (the hole in the middle) of 14,400 locations or so.
# Why is each location so slow?
# For some reason, it goes through 11,000 locations or so.
# But part B is going to be a little tricky. I need to optimize this.

# Well, what do you know. One tiny little optimization, and it takes four seconds instead of four minutes.

# I may need to optimize findOtherEnd. Make it some sort of dictionary.
# That would even help with portalName, now that I think about it.
# Maybe I'll need to do so in problem B.
